\begin{figure}
\setlength{\tabcolsep}{3pt}
{\bf Program Syntax} \\
\begin{tabular}{rclcl}
$g$ & $\in$ & $\Globals \subseteq \Var$ \\
$\tl$ & $\in$ & $\ThreadLocals \subseteq \Var$ \\
$l$ & $\in$ & $\Locals \subseteq \Var$ \\
$t$ & $\in$ & $\Type$ \\
$x,y$ & $\in$ & $\Var$ \\
$v$ &  $\in$ & $\Value$ \\
$e, \tau, \phi, \rho$ & $\in$ & $\StateExpr$ \\
$\alpha, \beta$ & $\in$ & $\TransExpr$ \\
$\locExpr$ & $\in$ & $\LocalStateExpr$ \\
$P$ & $\in$ & $\ProcName$ \\
$A$ & $\in$ & $\ActionName$ \\
$\bodies$ & $\in$ & $\ProcName \rightarrow \Stmt$ \\
$\specs$ & $\in$ & $\ActionName \rightarrow \TransExpr$ \\
$\pre,\post$ & $\in$ & $\ProcName \rightarrow \StateExpr$ \\
$\modvars$ & $\in$ & $\ProcName \rightarrow 2^\ThreadLocals$ \\
$\mov$ & $\in$ & $\ProcName \rightarrow \{B,R,L,N,\perp\}$ \\
$\act$ & $\in$ & $\ProcName \rightarrow \TransExpr$ \\
$\Prog$ & $\in$ & $\Program = (\varsG, \bodies, \specs, \pre, \post, \modvars, \mov, \act, \TS)$ \\
\end{tabular}
~\\
\begin{tabular}{rclcl}
$\Vinfo$ &::= & $x:t=v$ \\
$\varsG,\varsTL,\varsL \in \Vinfos$ \\
%$\stmt \in \Stmt$ &::= & $\skipstmt \mid \assert{\locExpr} \mid \yield{e} \mid$ \\
$\stmt \in \Stmt$ &::= & $\skipstmt \mid \yield{e} \mid$ \\
                  & & $\call{A} \mid \call{P} \mid \async{P} \mid $\\
                  & & $\ablock{e}{s} \mid s;\;s \mid$\\
                 & & $\ite{\locExpr}{s}{s} \mid$ \\
                  & & $\while{e,m}{\locExpr}{s}$ \\ 
$\Continuation \in \mathit{Continuation}$ & ::= & $(\varsL,\stmt) \mid (\varsL, \Continuation;\stmt)$ \\
$T \in \Thread$ & ::=  & $(\varsTL, \Continuation)$ \\
$\YieldingContinuation \in \mathit{YieldingContinuation}$ & ::= & $(\varsL,\yield{e};\stmt) \mid (\varsL, \YieldingContinuation;\stmt)$ \\
$\YieldingThread \in \mathit{YieldingThread}$ &::= &$(\varsTL, \YieldingContinuation)$ \\
$\StmtCtxt \in \mathit{StmtCtxt}$ &::= &$[]_{Stmt} \mid \StmtCtxt;s$ \\
$\ContinuationCtxt \in \mathit{ContinuationCtxt}$ &::= & $([]_{\Locals}, \StmtCtxt) \mid (L,\ContinuationCtxt;\stmt)$ \\
$\ThreadCtxt \in \mathit{ThreadCtxt}$ &::= &$([]_{\ThreadLocals}, \ContinuationCtxt)$ \\
$\ProgCtxt \in \mathit{ProgCtxt}$ &::= &$\YieldingThreads \cdot \ThreadCtxt \cdot \YieldingThreads$ \\
\end{tabular}\\
\setlength{\tabcolsep}{6pt}
\caption{Syntax}
\label{fig:syntax}
\end{figure}

\begin{figure}
\scriptsize{
\medskip
%%%%%%%%%%%%%%%%%%%%
$
\inferrule
{
\bodies,\specs \vdash (\varsG\!\cdot\!\varsTL\!\cdot\!\varsL, s) \trans (\varsG'\!\cdot\!\varsTL'\!\cdot\!\varsL', s')
}
{\bodies,\specs \vdash (\varsG, \ProgCtxt[\varsTL][\varsL][s]) \trans (\varsG', \ProgCtxt[\varsTL'][\varsL'][s'])}
\;(\textsc{Program-Step})
$
\medskip
%%%%%%%%%%%%%%%%%%%%
$
\inferrule
{
\bodies,\specs \vdash (\varsG\!\cdot\!\varsTL\!\cdot\!\varsL, s) \fails
}
{\bodies,\specs \vdash (\varsG, \ProgCtxt[\varsTL][\varsL][s]) \fails}
\;(\textsc{Program-Fail})
$
\medskip
%%%%%%%%%%%%%%%%%%%%
$
\inferrule
{
T' = (\varsTL, (\varsL, \yield{\pre(P)};\bodies(P)))
}
{\bodies,\specs \vdash (\varsG, \ProgCtxt[\varsTL][\varsL][\async{P}]) \trans (\varsG, \ProgCtxt[\varsL][\skipstmt] \cdot T')}
\;(\textsc{Async})
$
\medskip
%%%%%%%%%%%%%%%%%%%%
$
\inferrule
{
\\
}
{\bodies,\specs \vdash (\varsG, \YieldingThreads \cdot (\varsTL, \skipstmt) \cdot \YieldingThreads') \trans (\varsG, \YieldingThreads \cdot \YieldingThreads')}
\;(\textsc{Thread-End})
$
\medskip
%%%%%%%%%%%%%%%%%%%%
$
\inferrule
{
\\
}
{\bodies,\specs \vdash (\vars, \skipstmt;\stmt) \trans (\vars, \stmt)}
\;{(\textsc{Skip})}
$
\medskip
%%%%%%%%%%%%%%%%%%%%
$
\inferrule
{
\\
}
{\bodies,\specs \vdash (\vars, \Frame{\varsL'}{\skipstmt}) \trans (\vars, \skipstmt)}
\;{(\textsc{Frame})}
$
\medskip
%%%%%%%%%%%%%%%%%%%%
%% $
%% \inferrule
%% {
%% \vars \vdash \locExpr \rightarrow \true
%% }
%% {\bodies,\specs \vdash (\vars, \assert{\locExpr}) \trans (\vars, \skipstmt)}
%% \;{(\textsc{Assert-True})}
%% $
%% \medskip
%%%%%%%%%%%%%%%%%%%%
%% $
%% \inferrule
%% {
%% \vars \vdash \locExpr \rightarrow \false
%% }
%% {\bodies,\specs \vdash (\vars, \assert{\locExpr}) \fails}
%% \;{(\textsc{Assert-False})}
%% $
%% \medskip
%%%%%%%%%%%%%%%%%%%%
$
\inferrule
{
\specs(A) = \alpha\ \\
(\varsG\!\cdot\!\varsTL\!\cdot\!\varsL, \varsG'\!\cdot\!\varsTL'\!\cdot\!\varsL') \vdash \alpha \\
}
{
\bodies,\specs \vdash (\varsG\!\cdot\!\varsTL\!\cdot\!\varsL, \call{A}) \trans (\varsG'\!\cdot\!\varsTL'\!\cdot\!\varsL',\skipstmt)
}
\;{(\textsc{Atomic})}
$
\medskip
%%%%%%%%%%%%%%%%%%%%
$
\inferrule
{
}
{\bodies,\specs \vdash (\vars, \call{P}) \trans (\vars, \Frame{L}{\yield{\pre(P)};\bodies(P);\yield{\post(P)}})}
\;{(\textsc{Call})}
$
\medskip
%%%%%%%%%%%%%%%%%%%%
$
\inferrule
{
\\
}
{\bodies,\specs \vdash (\vars, \yield{e}) \trans (\vars, \skipstmt)}
\;{(\textsc{Yield})}
$
\medskip
%%%%%%%%%%%%%%%%%%%%
$
\inferrule
{
\vars \vdash e \rightarrow \true
}
{\bodies,\specs \vdash (\vars, \ablock{e}{\stmt}) \trans (\vars, \stmt)}
\;{(\textsc{AtomicBlock-Ok})}
$
\medskip
%%%%%%%%%%%%%%%%%%%%
$
\inferrule
{
\vars \vdash e \rightarrow \false
}
{\bodies,\specs \vdash (\vars, \ablock{e}{\stmt}) \fails}
\;{(\textsc{AtomicBlock-Fail})}
$
\medskip
%%%%%%%%%%%%%%%%%%%%
$
\inferrule
{
\vars \vdash \locExpr \rightarrow \mathit{true}
}
{\bodies,\specs \vdash (\vars, \ite{\locExpr}{s_1}{s_2}) \trans (\vars, s_1)}
\;{(\textsc{If-True})}
$
\medskip
%%%%%%%%%%%%%%%%%%%%
$
\inferrule
{
\vars \vdash \locExpr \rightarrow \mathit{false}
}
{\bodies,\specs \vdash (\vars, \ite{\locExpr}{s_1}{s_2}) \trans (\vars, s_2)}
\;{(\textsc{If-False})}
$
\medskip
%%%%%%%%%%%%%%%%%%%%
$
\inferrule
{
\vars \vdash \locExpr \rightarrow \mathit{false}
}
{\bodies,\specs \vdash (\vars, \while{e,m}{\locExpr}{s}) \trans (\vars, \skipstmt)}
\;{(\textsc{While-False})}
$
\medskip
%%%%%%%%%%%%%%%%%%%%
$
\inferrule
{
\vars \vdash \locExpr \rightarrow \mathit{true}
}
{\bodies,\specs \vdash (\vars, \while{e,m}{\locExpr}{s}) \trans (\vars, s;\while{e,m}{\locExpr}{s})}
\;{(\textsc{While-True})}
$
%%%%%%%%%%%%%%%%%%%%
}
\caption{Operational semantics}
\label{fig:operational-semantics}
\end{figure}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "paper"
%%% End: 


